<!-- /templates/mergedocs/PR.html  -->
{% extends 'base.html' %}
{% import 'bootstrap/wtf.html' as wtf %}
{% import 'widgets.html' as widgets %}

{% block app_content %}
<form method="POST" action="{{ url_for('pr_bp.pr_save_send', method=method, rent_id=rent_pr.id) }}">
    <div class="form-group row flex-row-reverse">
		<div class="col-md-2">
			<a href="{{ url_for('pr_bp.pr_dialog', rent_id=rent_pr.id, action='view') }}"
			   class="btn btn-block btn-primary" role="button">back</a>
		</div>
    </div>
	{% if method == "email" %}
		<div class="form-group row">
			<div class="col-md-3">
				{{ pr_form.email(class_="form-control") }}
				{% if pr_form.email.errors %}
					<ul class="errors">
						{% for error in pr_form.email.errors %}
							<li>{{ error }}</li>
						{% endfor %}
					</ul>
				{% endif %}
			</div>
			<div class="col-md-5">
				{{ pr_form.subject(class_="form-control") }}
			</div>
			<div class="col-md-4" align="bottom">
				{{ pr_form.submit(class_="btn btn-block btn-success") }}
			</div>
		</div>
	{% elif method == "post" %}
		<div class="form-group row">
			<div id="address_fields" class="col-md-8">
				{{ pr_form.mailaddr(class_="form-control") }}
			</div>
			<div id="new_address_fields" class="col-md-8">
				{{ pr_form_new_addr.new_mailaddr(class_="form-control") }}
			</div>
			<div class="col-md-4" align="bottom">
				{{ pr_form.submit(class_="btn btn-block btn-success") }}
			</div>
		</div>

		<div class="form-group row flex-row-reverse">
			<div class="col-md-4">
            	<button type="button" id="add_remove_address" class="btn btn-block btn-danger">manually change address</button>
			</div>
		</div>

	{% endif %}
	<div id="doc_html" contenteditable="true">
	    {% if method != "email" %}
			<div class="font-size-large" align="center">
				<b>{{ rent_pr.managername }}</b>
			</div>
			<div class="font-size-small" align="center">
				{{ rent_pr.manageraddr }}
				<br />
				{{ rent_pr.manageraddr2 }}
				<br />
			</div>
			<div class="font-size-medium" align="right">
				Our Ref: {{ rent_pr.rentcode }}
				<br />
				Date: {{ today_date.strftime('%d-%b-%Y') if today_date else 'none'  }}
			</div>
			<div class="font-size-medium" align="left">
				Dear {{ rent_pr.tenantname }}
			</div>
	    {% else %}
			<div class="font-size-medium" align="left">
				Our Ref: {{ rent_pr.rentcode }}
				<br />
				<br />
				Dear {{ rent_pr.tenantname }}
			</div>
		{% endif %}
		<div class="font-size-medium" align="left">
			<b>{{ widgets.linebreaks_for_string(subject) }}</b>
			<br />
			<br />
			<table class="pr_table">
				<tr class="pr_table_heading">
					<td>Details</a></td>
					<td>Amount</td>
				</tr>
			{% for statement, value in table_rows.items() %}
				<tr>
					<td>{{ statement }}</a></td>
					<td class="amount_class">{{ value }}</td>
				</tr>
			{% endfor %}
				<tr class="total">
					<td>The total amount payable is:</a></td>
					<td class="amount_class">{{ totdue_string }}</td>
				</tr>
			</table>
			<br />
			{{ widgets.linebreaks_for_string(block) }}
			<br />
			<br />
			Yours sincerely
			<br />
			<br />
			<br />
			<b>{{ rent_pr.managername }}</b>
			<br />
			{{ rent_pr.manageraddr }}
			<br />
			{{ rent_pr.manageraddr2 }}
			</div>
		</div>
	</div>
    <div class="form-group row">
		<div class="col-md-3">
            <input type="hidden" id="xinput" name="xinput" value = "xyz">
        </div>
    </div>
    <div class="form-group row">
		<div class="col-md-2">
            <input type="hidden" id="pr_save_data" name="pr_save_data" value = "{{ pr_save_data }}">
        </div>
    </div>
</form>
{% endblock %}